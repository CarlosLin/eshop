{"remainingRequest":"/Users/carlos/Desktop/E-shop/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/carlos/Desktop/E-shop/client/src/views/Items.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"/Users/carlos/Desktop/E-shop/client/src/views/Items.vue","mtime":1555294544660},{"path":"/Users/carlos/Desktop/E-shop/client/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/carlos/Desktop/E-shop/client/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/carlos/Desktop/E-shop/client/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/carlos/Desktop/E-shop/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/carlos/Desktop/E-shop/client/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.el-table .success-row {\n  background-color: #f0f9eb;\n}\n.activity{\n  color: red;\n}\n",{"version":3,"sources":["Items.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6JA;AACA;AACA;AACA;AACA;AACA","file":"Items.vue","sourceRoot":"src/views","sourcesContent":["<template lang=\"pug\">\n  .items\n    | 預設時間\n    el-row\n      el-col(:span='6' :offset='9')\n        datepicker(v-model='date')\n    el-row\n      el-col(:span='16' :offset='4')\n        ul(v-for='(ele, index) in  promotions')\n          li.activity  {{ele.type}}類促銷 ({{ele.discount*10}}折優惠) 時間{{ele.startDate | moment('dddd, MMM Do YYYY')}}~{{ele.endDate | moment('dddd, MMM Do YYYY')}}\n    el-row(:gutter='20')\n      el-col(:span='8' :offset='4')\n        el-table(:data=\"items\" :row-class-name='tableRowClassname')\n          el-table-column(prop='type' label='種類')\n          el-table-column(prop='name' label='名稱')\n          el-table-column(prop='price' label='價錢')\n          el-table-column(label='加入購物車')\n            template(slot-scope='scope')\n              i.el-icon-plus(@click='addToCart(scope.row); checkDiscount(promotions);')\n      el-col(:span='6' :offset='3')\n        el-table(:data='incart')\n          el-table-column(prop='name' label='名稱')\n          el-table-column(prop='quantity' label='數量')\n          el-table-column(label='小計')\n            template(slot-scope='scope')\n              | {{scope.row.price * scope.row.quantity | rounding}}\n        div(v-for='element in discount')\n          p(v-show='element.price>0') {{element.discount*10}}折 {{element.type}}類折扣 共折抵 {{element.price | rounding}}元\n        p.activity(v-show='couponUse') 使用折價卷 (滿1000折200)\n        div 總計: {{countQuantity}}件   總價: {{countTotal | rounding}} 元\n        el-col\n          el-col(:span='20' :offset='1')\n            form\n              el-input(v-model='coupon' placeholder='輸入折價卷')\n              el-button(type='success' icon='el-icon-check' circle @click='checkCoupon()')\n</template>\n<script>\nimport { mapGetters, mapActions } from 'vuex'\nimport datepicker from 'vue-date-pick'\nimport 'vue-date-pick/dist/vueDatePick.css'\nimport PromotionsService from '../../services/PromotionsService.js'\nexport default {\n  name: 'items',\n  data() {\n    return{\n      incart: [],\n      discount: [],\n      date: '2018-11-11',\n      coupon: '',\n      couponUse: false,\n      couponDiscount: 0\n    }\n  },\n  components: {\n    datepicker\n  },\n  created () {\n    this.getItemsApi()\n    this.getPromotionsApi(this.date)\n  },\n  computed: {\n    ...mapGetters({\n      items: 'getItems',\n      promotions: 'getPromotions'\n    }),\n    countQuantity: function() {\n      var countQuantity = 0\n      this.incart.forEach(ele => {\n        countQuantity += parseInt(ele.quantity)\n      })\n      return countQuantity\n    },\n    countTotal: function () {\n      var countTotal = 0.00\n      var countCost = 0\n      this.incart.forEach(ele => {\n        countTotal += parseFloat(ele.quantity*ele.price)\n      })\n      this.discount.forEach(element => {\n        countCost += element.price\n      })\n      if(this.couponUse === true && countTotal >= 1000) {\n        this.couponDiscount = 200\n      }\n      return countTotal - countCost - this.couponDiscount\n    }\n  },\n  methods: {\n    ...mapActions([\n      'getItemsApi',\n      'getPromotionsApi'\n    ]),\n    addToCart: function(item) {\n      var newCartItem = {};\n      newCartItem.id = item.id\n      newCartItem.name = item.name\n      newCartItem.type = item.type\n      newCartItem.price = item.price\n      var newQuantity = 1\n      this.incart.forEach(ele => {\n        if(ele.id === item.id){\n          newQuantity = parseInt(ele.quantity) +1\n          var theOldOneIndex = this.incart.indexOf(ele)\n          this.incart.splice(theOldOneIndex, 1)\n        }\n      })\n      newCartItem.quantity = newQuantity\n      this.incart.push(newCartItem)\n    },\n    checkDiscount: function(promotions) {\n      this.discount = []\n      promotions.forEach(element => {\n        var countTotal = 0\n        this.incart.forEach(e => {\n          if(e.type === element.type){\n            countTotal += e.price * e.quantity\n          }\n        });\n        var result = countTotal * (1-element.discount)\n        this.discount.push({\n          type: element.type,\n          discount: element.discount,\n          price: result\n        })\n      });\n    },\n    tableRowClassname({rowIndex}) {\n      if (rowIndex%2 === 1) {\n        return 'success-row'\n      } \n      return ''\n    },\n    checkCoupon () {\n      console.log('Check Coupon',this.coupon, this.date)\n      PromotionsService.checkCoupon({\n        sn: this.coupon,\n        date: this.date\n      }).then((data) => {\n        if (data.data.code === 1) {\n          this.couponUse = true\n        }\n      })\n    }\n  },\n  watch: {\n    date () {\n      this.getPromotionsApi(this.date)\n    }\n  },\n  filters: {\n    rounding (value) {\n      return value.toFixed(2)\n    }\n  }\n}\n</script>\n<style>\n  .el-table .success-row {\n    background-color: #f0f9eb;\n  }\n  .activity{\n    color: red;\n  }\n</style>\n"]}]}